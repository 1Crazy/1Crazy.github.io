{"title":"使用node.js抓取其他网站数据,以及cheerio的使用","slug":"spider","date":"2018-09-18T15:10:06.000Z","updated":"2019-04-05T03:27:11.440Z","comments":true,"excerpt":"","content":"<h1 id=\"使用node-js抓取其他网站数据，以及cheerio的介绍\"><a href=\"#使用node-js抓取其他网站数据，以及cheerio的介绍\" class=\"headerlink\" title=\"使用node.js抓取其他网站数据，以及cheerio的介绍\"></a>使用node.js抓取其他网站数据，以及cheerio的介绍</h1><h2 id=\"基本思路\"><a href=\"#基本思路\" class=\"headerlink\" title=\"基本思路\"></a>基本思路</h2><p>&nbsp;　　首先寻找一个网址：<a href=\"http://tech.ifeng.com/，因为这个是http协议，所以我们需要用到node.js的HTTP模块，我们使用HTTP模块中的get()方法进行抓取。其中假如我们不需要抓取的所有数据，而我们只需要其中的部分数据，比如某个类下面的a标签里的文字，这时如果是在前端中我们可以用DOM操作找到这个节点，但是node.js中没有DOM操作，所以这里我们需要用到cheerio这个库。既然抓取了网站上的数据就会涉及到文件的写入，这时需要用到node.js中的fs模块。\" target=\"_blank\" rel=\"noopener\">http://tech.ifeng.com/，因为这个是http协议，所以我们需要用到node.js的HTTP模块，我们使用HTTP模块中的get()方法进行抓取。其中假如我们不需要抓取的所有数据，而我们只需要其中的部分数据，比如某个类下面的a标签里的文字，这时如果是在前端中我们可以用DOM操作找到这个节点，但是node.js中没有DOM操作，所以这里我们需要用到cheerio这个库。既然抓取了网站上的数据就会涉及到文件的写入，这时需要用到node.js中的fs模块。</a></p>\n<h2 id=\"学习网址\"><a href=\"#学习网址\" class=\"headerlink\" title=\"学习网址\"></a>学习网址</h2><blockquote>\n<p><a href=\"https://cheerio.js.org/\" target=\"_blank\" rel=\"noopener\">cheerio官方学习文档</a><br><br><a href=\"https://www.npmjs.com/package/cheerio\" target=\"_blank\" rel=\"noopener\">cheerio npm网址</a><br><br><a href=\"https://nodejs.org/dist/latest-v10.x/docs/api/\" target=\"_blank\" rel=\"noopener\">node.js官方文档</a><br><br><a href=\"http://nodejs.cn/api/\" target=\"_blank\" rel=\"noopener\">node.js中文文档</a><br></p>\n</blockquote>\n<h2 id=\"什么是cheerio以及如何使用\"><a href=\"#什么是cheerio以及如何使用\" class=\"headerlink\" title=\"什么是cheerio以及如何使用\"></a>什么是cheerio以及如何使用</h2><p>&nbsp;　　cheerio是专为服务器设计的核心jQuery的快速，灵活和精益实现。他可以像jquery一样操作字符串。</p>\n<p>安装cheerio</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install cheerio</span><br></pre></td></tr></table></figure>\n<p>具体使用</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">'cheerio'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> $ = cheerio.load(<span class=\"string\">'&lt;h2 class=\"title\"&gt;Hello world&lt;/h2&gt;'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">$(<span class=\"string\">'h2.title'</span>).text(<span class=\"string\">'Hello there!'</span>)</span><br><span class=\"line\">$(<span class=\"string\">'h2'</span>).addClass(<span class=\"string\">'welcome'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">$.html()</span><br><span class=\"line\"><span class=\"comment\">//=&gt; &lt;h2 class=\"title welcome\"&gt;Hello there!&lt;/h2&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"具体代码\"><a href=\"#具体代码\" class=\"headerlink\" title=\"具体代码\"></a>具体代码</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> http = <span class=\"built_in\">require</span>(<span class=\"string\">\"http\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">\"fs\"</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> cheerio = <span class=\"built_in\">require</span>(<span class=\"string\">\"cheerio\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">http.get(<span class=\"string\">\"http://tech.ifeng.com/\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 设置编码</span></span><br><span class=\"line\">\tres.setEncoding(<span class=\"string\">\"utf8\"</span>);</span><br><span class=\"line\">\t<span class=\"comment\">// 当接收到数据时，会触发 \"data\" 事件的执行</span></span><br><span class=\"line\">\t<span class=\"keyword\">let</span> html = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">\tres.on(<span class=\"string\">\"data\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">data</span>)</span>&#123;</span><br><span class=\"line\">\t\thtml += data;</span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">// 数据接收完毕，会触发 \"end\" 事件的执行</span></span><br><span class=\"line\">\tres.on(<span class=\"string\">\"end\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 待保存到文件中的字符串</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> fileData = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 调用 cheerio.load() 方法，生成一个类似于 jQuery 的对象</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> $ = cheerio.load(html);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 接下来像使用 jQuery 一样来使用 cheerio</span></span><br><span class=\"line\">\t\t$(<span class=\"string\">\".pictxt02\"</span>).each(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">index, element</span>) </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> el = $(element);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">let</span> link = el.find(<span class=\"string\">\"h3 a\"</span>).attr(<span class=\"string\">\"href\"</span>),</span><br><span class=\"line\">\t\t\t\ttitle = el.find(<span class=\"string\">\"h3 a\"</span>).text(),</span><br><span class=\"line\">\t\t\t\tdesc = el.children(<span class=\"string\">\"p\"</span>).text();</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tfileData += <span class=\"string\">`<span class=\"subst\">$&#123;link&#125;</span>\\r\\n<span class=\"subst\">$&#123;title&#125;</span>\\r\\n\\t<span class=\"subst\">$&#123;desc&#125;</span>\\r\\n\\r\\n`</span>;</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// console.log(\"读取结束，内容：\");</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// console.log(html);</span></span><br><span class=\"line\">\t\tfs.writeFile(<span class=\"string\">\"./dist/source.txt\"</span>, fileData, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err</span>) </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (err)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">\"成功\"</span>)</span><br><span class=\"line\">\t\t&#125;);</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n","thumbnail":"/img/home.jpg","categories":[],"tags":[]}